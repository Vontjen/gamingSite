<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"></script>
    <title>Title</title>
</head>
<body>

<div class="container">
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Id</th>
            <th>Name</th>
            <th>Developer</th>
            <th>Publisher</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="game-list-data">

        </tbody>
    </table>

<form id="game-create-form">
    <div class="form-group">
        <label for="name">Name:</label>
        <input class="form-control" id="name" name="name"/>
    </div>
    <div class="form-group">
        <label for="developer">Developer</label>
        <input class="form-control" id="developer" name="developer"/>
    </div>
    <div class="form-group">
        <label for="publisher">publisher</label>
        <input class="form-control" id="publisher" name="publisher"/>
    </div>
    <input type="submit" class="btn btn-primary" value="Create">
</form>
</div>


<script>
    $("#game-create-form").submit(function(e) {
        e.preventDefault();


        let p = {
            name: $(this.name).val(),
            developer: $(this.developer).val(),
            publisher: $(this.publisher).val()
        };

        $.ajax({
            method: 'post',
            url: '/api/game',
            contentType: 'application/json',
            data: JSON.stringify(p),
            processData: false,
            success: loadGames
        });

        this.reset();
    });

    loadGames();

    function loadGames() {
        $.getJSON('/api/game/all', function (games) {
            let $tbody = $("#game-list-data").empty();

            for (let game of games) {
                let $removeButton = $("<button>").addClass("btn").addClass("btn-danger").text("Remove");
                $removeButton.click(function(e) {
                    $.ajax({
                        method: 'delete',
                        url: `/api/game/${game.id}`,
                        success: loadGames
                    });
                });

                let $row = $('<tr>')
                    .append($('<td>').text(game.id))
                    .append($('<td>').text(game.name))
                    .append($('<td>').text(game.developer))
                    .append($('<td>').text(game.publisher))
                    .append($('<td>').append($removeButton));
                $tbody.append($row);
            }
        });
    }
</script>

</body>
</html>